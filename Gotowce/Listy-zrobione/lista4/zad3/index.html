<html>
<meta charset="utf-8" />

<head>
	<script src="/socket.io/socket.io.js"></script>
	<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
	<style id='s'>
        body {
            background-image: url("https://cdn.shortpixel.ai/client/q_glossy,ret_img,w_640/https://wingsofquality.eu/wp-content/uploads/2020/04/drewno.jpg");
            text-align: center;
        }

        #g {
            position: absolute;
            margin-left: 50%;
            transform: translate(-50%, 0);
        }

        td {
            width: 60px;
            height: 60px;
            border: 1px solid gray;
            background-color: antiquewhite;
        }

        td div {
            width: 60px;
            height: 60px;
            background-size: 60px 60px;
            visibility: hidden;
            /* zachowuja wys i szer */
        }

        p,
        h1 {
            font-size: large;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            background-color: wheat;
            padding: 10px;
        }

        p#wyniki {
            margin-top: 40px;
            float: left;
            min-height: 60px;
            min-width: 200px;
        }

        p#instrukcja {
            float: right;
            margin-top: 40px;
            min-width: 100px;
            text-align: center;
        }

        button {
            float: bottom;
            margin-top: 20px;
            width: 100px;
            height: 40px;
            background-color: wheat;
            color: rgb(0, 0, 0);
            border-left: 10px solid rgb(83, 39, 9);
            border-bottom: 10px solid rgb(83, 39, 9);
            border-right: 10px solid rgb(139, 68, 17);
            border-top: 10px solid rgb(145, 70, 17);
        }
	</style>
</head>

<body>
	<h1>Memory</h1>
    <div id='g'>
        <button class="gracze" onclick="me = 0; player = 0; server_connect();">Gracz 1</button>
        <button class="gracze" onclick="me = 1; player = 0; server_connect();">Gracz 2</button>
        <button onclick="restart = 1; clearTable(); server_connect(); start(); restart = 0;">Nowa gra</button>
        <table id='plansza'></table>
    </div>
    <p id='wyniki'></p>
    <p id="instrukcja">Znajdź więcej par niż przeciwnik!</p>
	<div>
		<input type='text' id='txtmessage' />
		<button id='reset'>Nowa gra</button>
		<ul id='messages'></ul>
	</div>
	<script>
		var socket = io();
		var nick = prompt("Podaj swój nick");
	
		socket.emit('nick', nick);
	
		var messages = document.getElementById('messages');
		var reset_button = document.getElementById('reset');
		var msg_input = document.getElementById('txtmessage');
	
		msg_input.focus();
		
		for (let i = 1; i <= 25; i++) {
            $("#s").append('[class="' + i + '"] { background-image: url("' + i + '.png"); }');
        }

		// plansza
		function plansza(){
			$("#plansza").children().remove();
			if ($("#plansza").html() == "") {
                let x = 0;
                for (let i = 0; i < 10; i++) {
                    $("#plansza").append("<tr>");
                    for (let j = 0; j < 10; j++) {
                        $("#plansza tr").eq(i).append("<td id='" + x + "'><div class=''></div></td>");
                        x++;
                    }
                }
            }
		}
		plansza();

		var td = document.querySelectorAll('td');
		var i = 0, j = 0;
		var pionek = 'x';
		var color = 'white';
	
		// wysyłanie wiadomości o ruchu
		function ruch() {
			if (this.clicked == true) return;					// niepowtarzanie klikniec
			socket.emit('move', JSON.stringify({ pole: this.pole, pionek: pionek }));
		}

		for (let x of td) {
			x.style.background = 'white';
			x.pole = i++;
			x.onclick = ruch;
		}
	
		// odbieranie wiadomości 
		socket.on('chat message', function (data) {
			messages.innerHTML += "<li>" + data + "</li>";
		});
	
		// odbieranie wiadomości o resecie
		socket.on('reset', function (msg) {
			messages.innerHTML = "<li>" + msg + " " + nick + "!</li>";
			plansza();
		});
	
		// odbieranie wiadomości o przyznanym id
		socket.on('id', function (msg) {
			pionek = msg;
		});
	
		// odbieranie wiadomości o ruchu
		socket.on('move', function (msg) {
			let x = JSON.parse(msg);
			if (x.color)
				td[x.pole].style.background = x.color;
			else
				td[x.pole].style.background = (x.pionek == pionek ? "white" : "pink");
			td[x.pole].innerHTML = x.pionek;
			
		});
	
		// wysyłanie wiadomości z okienka czatu
		msg_input.addEventListener('change', function () {
			socket.emit('chat message', "<b>" + nick + ":</b> " + this.value);
			this.value = '';
	
		});
	
		// wysyłanie wiadomości o resecie
		reset_button.addEventListener('click', function () {
			socket.emit('reset', "Witaj");
		});
	
	</script>
</body>
</html>